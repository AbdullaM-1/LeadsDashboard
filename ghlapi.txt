/**
 * Demonstrates creating a contact in GoHighLevel using the REST API.
 * Uses Node's built-in fetch (Node 18+ required) and a hard-coded token.
 */

async function createContact() {
  const token = 'pit-a15f6a3b-802f-4cc5-8d1b-593f46876481';
  console.log('[createContact] Using token prefix:', token.slice(0, 6));

  const url = 'https://services.leadconnectorhq.com/contacts/';
  console.log('[createContact] Target URL:', url);

  const body = {
    firstName: 'Rosan',
    lastName: 'Deo',
    name: 'Rosan Deo',
    email: 'rosan.deo@example.com',
    locationId: 'kHaYNrf839lT1bbwMHUO',
    phone: '+1 888-888-8888',
    tags: ['demo']
  };

  console.log('[createContact] Request payload:', JSON.stringify(body, null, 2));

  const requestOptions = {
    method: 'POST',
    headers: {
      Authorization: `Bearer ${token}`,
      'Content-Type': 'application/json',
      Version: '2021-07-28'
    },
    body: JSON.stringify(body)
  };
  console.log('[createContact] Request options:', {
    method: requestOptions.method,
    headers: requestOptions.headers
  });

  const response = await fetch(url, requestOptions);
  console.log('[createContact] Response status:', response.status);
  console.log('[createContact] Response headers:', Object.fromEntries(response.headers.entries()));

  if (!response.ok) {
    const errorText = await response.text();
    console.error('[createContact] Error response body:', errorText);
    throw new Error(`GoHighLevel API error: ${response.status} ${errorText}`);
  }

  const data = await response.json();
  console.log('[createContact] Parsed response:', JSON.stringify(data, null, 2));
  return data;
}

if (require.main === module) {
  console.log('[createContact] Script invoked directly');
  createContact()
    .then((data) => {
      console.log('[createContact] Created contact successfully:', JSON.stringify(data, null, 2));
    })
    .catch((err) => {
      console.error('[createContact] Failed to create contact:', err);
      process.exitCode = 1;
    });
}

module.exports = { createContact };

